---
title: "MS 5"
author: "Rachel Auslander"
date: "3/23/2020"
output: html_document
---

[My ms5 github repo (which I need to rename as my project repo)](https://github.com/rachelaus/ms_4)

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(haven)
library(twitteR)
library(rvest)
```

```{r reading in data, include = FALSE}
dec26 <- read_dta("ns20191226/ns20191226.dta")
```

```{r filtering data 1, include = FALSE}
nyt <- dec26 %>% 
  select(news_sources_fox, news_sources_cnn, news_sources_npr, vote_2016) %>% filter(news_sources_fox == 1) %>% 
  filter(vote_2016 == 1 | vote_2016 == 2)
```

```{r filtering data 2, include = FALSE}
viewbyage <- dec26 %>%
  select(age, news_sources_msnbc, news_sources_cnn, news_sources_facebook, news_sources_fox, news_sources_network, 
news_sources_localtv, news_sources_telemundo, news_sources_npr, news_sources_amtalk, news_sources_new_york_times, 
news_sources_local_newspaper) %>% arrange(age) %>% 
#news_sources_other_TEXT

# levels for new column age category
#mutate and create a new variable rather than overriding
mutate(age_range =
case_when(
  between(age, 18, 23) ~ "18-23",
  between(age, 24, 30) ~ "24-30",
  between(age, 31, 55) ~ "31-55",
  between(age, 56, 75) ~ "56-75",
  between(age, 76, 99) ~ "76-99"
)) %>%
  select(-age) %>%
  arrange(age_range) %>%
  filter(age_range == "18-23") %>%
  mutate(msnbc_reads = sum(news_sources_msnbc == 1)) %>%
  mutate(nyt_reads = sum(news_sources_new_york_times == 1)) %>%
  mutate(cnn_reads = sum(news_sources_cnn == 1))
```

I was able to use case_when to make my age ranges! Yay! Thank you for your help! My big problem now is figuring out how to find the total of people in each age range who read each news source. I think that I need to create a loop using either apply() or lapply(). Right now, I am adding the sum to a new column, but that means that I am creating a sum in every single row for every row marked as 18-23. I think that means that I need to pivot my data before I find the sum of people who read each news source in each age range? I am stuck.

I want to ultimately pivot the table so there is a news source column on the left, and then each of the age ranges in following columns. Each row in the news source column will contain the newspaper name, and each row in the age range column will contain the total number of people who read the news source. I will make a bar chart (x axis = age range, y axis = number of readers, fill = news source).

I know that I did not get a lot done the past 2 weeks, but I am going to get more done this week for sure! I think I am better now at breaking up what I want to do in small steps and trying to figure out each small step, even if I am not exactly sure of how to approach the problem. I also am more settled in to working from home. Could we possibly meet on Tuesday or Wednesday to discuss how to wrangle my table? 


```{r grouping data, include = FALSE}
newssource <- dec26 %>%
  select(age, news_sources_msnbc, news_sources_fox) %>%
  arrange(age) 

newssource$age_grouping <- cut(newssource$age, seq(17, 100, 6))
```

```{r scraping tweets, include = FALSE}
# how do i save the tokens not in a code chunk?

# Set API Keys
# api_key <- ""
# api_secret <- ""
# access_token <- ""
# access_token_secret <- ""
# setup_twitter_oauth(api_key, api_secret, access_token, access_token_secret)

# https://www.r-bloggers.com/how-to-use-r-to-scrape-tweets-super-tuesday-2016/

# grabbing tweets
#tweets_sanders <- userTimeline('@BernieSanders', n=200)
#tweets_warren <-userTimeline('@ewarren', n = 200)
#tweets_biden <- userTimeline('@joebiden', n = 200)

#feed_sanders <- laply(tweets_sanders, function(t) t$getText())
#feed_warren <- laply(tweets_warren, function(t) t$getText())
#feed_biden <- laply(tweets_biden, function(t) t$getText())
```

```{r scraping headlines, include = FALSE}

headlines_sanders <- read_html('https://www.nytimes.com/search?dropmab=false&endDate=20200307&query=bernie%20sanders&sort=best&startDate=20190307&types=article')

title_sanders <- headlines_sanders %>% html_nodes('h4.css-2fgx4k') %>% html_text()

```
